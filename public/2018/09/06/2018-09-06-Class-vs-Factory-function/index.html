<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<link rel="manifest" href="/manifest.json">
































<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/VK.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.png?v=6.6.0">


  <link rel="mask-icon" href="/images/VK.svg?v=6.6.0" color="#222">









<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="一直以为ES6出了后，新特性都是值得推广、使用的，直到看了这篇文章，甚有醍醐灌顶之感，来不及翻译，直接转载过来（原文需要翻墙查看） 原文地址：Class vs Factory function: exploring the way forward  ECMAScript 2015 (aka ES6) comes with the class syntax, so now we have two c">
<meta name="keywords" content="JavaScript,转载,ES6">
<meta property="og:type" content="article">
<meta property="og:title" content="[转载]Class vs Factory function: exploring the way forward">
<meta property="og:url" content="http://yoursite.com/2018/09/06/2018-09-06-Class-vs-Factory-function/index.html">
<meta property="og:site_name" content="VK Blog | 高闻灿的博客">
<meta property="og:description" content="一直以为ES6出了后，新特性都是值得推广、使用的，直到看了这篇文章，甚有醍醐灌顶之感，来不及翻译，直接转载过来（原文需要翻墙查看） 原文地址：Class vs Factory function: exploring the way forward  ECMAScript 2015 (aka ES6) comes with the class syntax, so now we have two c">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-12-17T02:55:47.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[转载]Class vs Factory function: exploring the way forward">
<meta name="twitter:description" content="一直以为ES6出了后，新特性都是值得推广、使用的，直到看了这篇文章，甚有醍醐灌顶之感，来不及翻译，直接转载过来（原文需要翻墙查看） 原文地址：Class vs Factory function: exploring the way forward  ECMAScript 2015 (aka ES6) comes with the class syntax, so now we have two c">






  <link rel="canonical" href="http://yoursite.com/2018/09/06/2018-09-06-Class-vs-Factory-function/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>[转载]Class vs Factory function: exploring the way forward | VK Blog | 高闻灿的博客</title>
  












  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">VK Blog | 高闻灿的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">一个浪漫 | 有情调 | 文艺の | 小Coder</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

    <a href="https://github.com/forrany" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/06/2018-09-06-Class-vs-Factory-function/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Ko">
      <meta itemprop="description" content="忧绪相伴，在浪漫的气息中回忆过去，敲着代码">
      <meta itemprop="image" content="/images/taka.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VK Blog | 高闻灿的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">[转载]Class vs Factory function: exploring the way forward

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-06 12:00:00" itemprop="dateCreated datePublished" datetime="2018-09-06T12:00:00+08:00">2018-09-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-17 10:55:47" itemprop="dateModified" datetime="2018-12-17T10:55:47+08:00">2018-12-17</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/06/2018-09-06-Class-vs-Factory-function/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2018/09/06/2018-09-06-Class-vs-Factory-function/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                <span title="本文字数">9.8k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                <span title="阅读时长">18 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>一直以为ES6出了后，新特性都是值得推广、使用的，直到看了这篇文章，甚有醍醐灌顶之感，来不及翻译，直接转载过来（原文需要翻墙查看）</p>
<p>原文地址：<a href="https://medium.freecodecamp.org/class-vs-factory-function-exploring-the-way-forward-73258b6a8d15" target="_blank" rel="noopener"><strong>Class vs Factory function: exploring the way forward</strong></a></p>
<hr>
<p>ECMAScript 2015 (aka ES6) comes with the class syntax, so now we have two competing patterns for creating objects. In order to compare them, I’ll create the same object definition (TodoModel) as a class, and then as a factory function.</p>
<p><a href="https://jsfiddle.net/cristi_salcescu/m9dhpzfx/" target="_blank" rel="noopener"><strong>TodoModel as a Class</strong></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class TodoModel &#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        this.todos = [];</span><br><span class="line">        this.lastChange = null;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    addToPrivateList()&#123;</span><br><span class="line">        console.log(&quot;addToPrivateList&quot;); </span><br><span class="line">    &#125;</span><br><span class="line">    add() &#123; console.log(&quot;add&quot;); &#125;</span><br><span class="line">    reload()&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://jsfiddle.net/cristi_salcescu/bcta6yyv/" target="_blank" rel="noopener"><strong>TodoModel as a Factory Function</strong></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function TodoModel()&#123;</span><br><span class="line">    var todos = [];</span><br><span class="line">    var lastChange = null;</span><br><span class="line">        </span><br><span class="line">    function addToPrivateList()&#123;</span><br><span class="line">        console.log(&quot;addToPrivateList&quot;); </span><br><span class="line">    &#125;</span><br><span class="line">    function add() &#123; console.log(&quot;add&quot;); &#125;</span><br><span class="line">    function reload()&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    return Object.freeze(&#123;</span><br><span class="line">        add,</span><br><span class="line">        reload</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Encapsulation"><a href="#Encapsulation" class="headerlink" title="Encapsulation"></a>Encapsulation</h3><p>The first thing we notice is that all members, fields, and methods of a class object are public.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var todoModel = new TodoModel();</span><br><span class="line">console.log(todoModel.todos);     //[]</span><br><span class="line">console.log(todoModel.lastChange) //null</span><br><span class="line">todoModel.addToPrivateList();     //addToPrivateList</span><br></pre></td></tr></table></figure>
<p>The lack of encapsulation may create security problems. Take the example of a global object that can be modified directly from the Developer Console.</p>
<p>When using factory function, only the methods we expose are public, everything else is encapsulated.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var todoModel = TodoModel();</span><br><span class="line">console.log(todoModel.todos);     //undefined</span><br><span class="line">console.log(todoModel.lastChange) //undefined</span><br><span class="line">todoModel.addToPrivateList();     //taskModel.addToPrivateList</span><br><span class="line">                                    is not a function</span><br></pre></td></tr></table></figure>
<h3 id="this"><a href="#this" class="headerlink" title="this"></a>this</h3><p><code>this</code> losing context problems are still there when using class. For example, <code>this</code> is losing context in nested functions. It is not only annoying during coding, but it’s also a constant source of bugs.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class TodoModel &#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        this.todos = [];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    reload()&#123; </span><br><span class="line">        setTimeout(function log() &#123; </span><br><span class="line">           console.log(this.todos);    //undefined</span><br><span class="line">        &#125;, 0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">todoModel.reload();                   //undefined</span><br></pre></td></tr></table></figure>
<p>or <code>this</code> is losing context when the method is used as a callback, like on a DOM event.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;#btn&quot;).click(todoModel.reload);    //undefined</span><br></pre></td></tr></table></figure>
<p>There are no such problems when using a factory function, as it doesn’t use <code>this</code> at all.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function TodoModel()&#123;</span><br><span class="line">    var todos = [];</span><br><span class="line">        </span><br><span class="line">    function reload()&#123; </span><br><span class="line">        setTimeout(function log() &#123; </span><br><span class="line">           console.log(todos);        //[]</span><br><span class="line">       &#125;, 0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">todoModel.reload();                   //[]</span><br><span class="line">$(&quot;#btn&quot;).click(todoModel.reload);    //[]</span><br></pre></td></tr></table></figure>
<h4 id="this-and-arrow-function"><a href="#this-and-arrow-function" class="headerlink" title="this and arrow function"></a>this and arrow function</h4><p>The arrow function partially solves the <code>this</code> loosing context issues in classes, but at the same time creates a new problem:</p>
<ul>
<li><code>this</code> is no longer loosing context in nested functions</li>
<li><code>this</code> is loosing context when the method is used as a callback</li>
<li>arrow function promotes the use of anonymous functions</li>
</ul>
<p><a href="https://jsfiddle.net/cristi_salcescu/y0k18og2/" target="_blank" rel="noopener">I refactored the </a><code>TodoModel</code><a href="https://jsfiddle.net/cristi_salcescu/y0k18og2/" target="_blank" rel="noopener"> using the arrow function</a>. It’s important to note that in the process of refactoring to the arrow function we can loose something very important for readability, the function name. <a href="https://jsfiddle.net/cristi_salcescu/y0k18og2/" target="_blank" rel="noopener">Look for example</a> at:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//using function name to express intent</span><br><span class="line">setTimeout(function renderTodosForReview() &#123; </span><br><span class="line">      /* code */ </span><br><span class="line">&#125;, 0);</span><br><span class="line">//versus using an anonymous function</span><br><span class="line">setTimeout(() =&gt; &#123; </span><br><span class="line">      /* code */ </span><br><span class="line">&#125;, 0);</span><br></pre></td></tr></table></figure>
<h3 id="Immutable-API"><a href="#Immutable-API" class="headerlink" title="Immutable API"></a>Immutable API</h3><p>Once the object is created, I’m expecting its API to be immutable. I can easily change the implementation of a public method to do something else when it was created using a class.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">todoModel.reload = function() &#123; console.log(&quot;a new reload&quot;); &#125;</span><br><span class="line">todoModel.reload();            //a new reload</span><br></pre></td></tr></table></figure>
<p><a href="https://jsfiddle.net/cristi_salcescu/y0k18og2/" target="_blank" rel="noopener">This problem can be solved</a> by calling <code>Object.freeze(TodoModel.prototype)</code>after the class definition.</p>
<p>The API of the object created using a factory function is immutable. Notice the use of <code>Object.freeze()</code> on the returned object containing only the public methods. The private data of the object can be modified, but only through these public methods.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">todoModel.reload = function() &#123; console.log(&quot;a new reload&quot;); &#125;</span><br><span class="line">todoModel.reload();            //reload</span><br></pre></td></tr></table></figure>
<h3 id="new"><a href="#new" class="headerlink" title="new"></a>new</h3><p><code>new</code> should be used when creating objects using classes.</p>
<p><code>new</code> is not required when creating objects with factory functions, but if that makes it more readable, you can go for it, there is no harm.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var todoModel= new TodoModel();</span><br></pre></td></tr></table></figure>
<p><a href="https://jsfiddle.net/cristi_salcescu/4j8wpfhx/" target="_blank" rel="noopener"><strong>Using</strong> </a><code>new</code><a href="https://jsfiddle.net/cristi_salcescu/4j8wpfhx/" target="_blank" rel="noopener"> <strong>with a factory function</strong></a> <strong>will just return the object created by the factory.</strong></p>
<h3 id="Composition-over-inheritance"><a href="#Composition-over-inheritance" class="headerlink" title="Composition over inheritance"></a>Composition over inheritance</h3><p>Classes support both inheritance and composition.</p>
<p>Below is an <a href="https://jsfiddle.net/cristi_salcescu/1xo96yt8/" target="_blank" rel="noopener">example of inheritance</a> where <code>SpecialService</code> class inherits from <code>Service</code> class:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Service &#123;</span><br><span class="line">  doSomething()&#123; console.log(&quot;doSomething&quot;); &#125;</span><br><span class="line">&#125;</span><br><span class="line">class SpecialService extends Service &#123;</span><br><span class="line">  doSomethingElse()&#123; console.log(&quot;doSomethingElse&quot;); &#125;  </span><br><span class="line">&#125;</span><br><span class="line">var specialService = new SpecialService();</span><br><span class="line">specialService.doSomething();</span><br><span class="line">specialService.doSomethingElse();</span><br></pre></td></tr></table></figure>
<p><a href="https://jsfiddle.net/cristi_salcescu/vwdwvvov/" target="_blank" rel="noopener">Here is another example</a> where <code>SpecialService</code> reuses member of <code>Service</code>using composition:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class Service &#123;</span><br><span class="line">  doSomething()&#123; console.log(&quot;doSomething&quot;); &#125;</span><br><span class="line">&#125;</span><br><span class="line">class SpecialService&#123;</span><br><span class="line">  constructor(args)&#123;</span><br><span class="line">    this.service = args.service;</span><br><span class="line">  &#125;</span><br><span class="line">  doSomething() &#123; this.service.doSomething(); &#125; </span><br><span class="line">  </span><br><span class="line">  doSomethingElse()&#123; console.log(&quot;doSomethingElse&quot;); &#125;</span><br><span class="line">&#125;</span><br><span class="line">var specialService = new SpecialService(&#123;</span><br><span class="line">   service : new Service()</span><br><span class="line">&#125;);</span><br><span class="line">specialService.doSomething();</span><br><span class="line">specialService.doSomethingElse();</span><br></pre></td></tr></table></figure>
<p>Factory functions promote composition over inheritance. <a href="https://jsfiddle.net/cristi_salcescu/jgbhkb4o/" target="_blank" rel="noopener">Take a look at the next example</a> where <code>SpecialService</code> reuses members of <code>Service</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function Service() &#123;</span><br><span class="line">  function doSomething()&#123; console.log(&quot;doSomething&quot;); &#125;</span><br><span class="line">  return Object.freeze(&#123;</span><br><span class="line">    doSomething</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">function SpecialService(args)&#123;</span><br><span class="line">  var service = args.service;</span><br><span class="line">  function doSomethingElse()&#123; console.log(&quot;doSomethingElse&quot;); &#125;</span><br><span class="line">  return Object.freeze(&#123;</span><br><span class="line">    doSomething : service.doSomething,</span><br><span class="line">    doSomethingElse</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">var specialService = SpecialService(&#123;</span><br><span class="line">   service : Service()</span><br><span class="line">&#125;);</span><br><span class="line">specialService.doSomething();</span><br><span class="line">specialService.doSomethingElse();</span><br></pre></td></tr></table></figure>
<h3 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h3><p>Classes are better at memory conservation, as they are implemented over the prototype system. All methods will be created only once in the prototype object and shared by all instances.</p>
<p>The memory cost of the factory function is noticeable when creating thousands of the same object.</p>
<p><a href="https://plnkr.co/edit/4cxGfN?p=info" target="_blank" rel="noopener">Here is the page used for testing the memory cost</a> when using factory function.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">The memory cost (in Chrome)</span><br><span class="line">+-----------+------------+------------+</span><br><span class="line">| Instances | 10 methods | 20 methods |</span><br><span class="line">+-----------+---------------+---------+</span><br><span class="line">| 10        | 0          |  0         |</span><br><span class="line">| 100       | 0.1Mb      |  0.1Mb     |</span><br><span class="line">| 1000      | 0.7Mb      |  1.4Mb     |</span><br><span class="line">| 10000     | 7.3Mb      | 14.2Mb     |</span><br><span class="line">+-----------+------------+------------+</span><br></pre></td></tr></table></figure>
<h3 id="Objects-vs-Data-Structures"><a href="#Objects-vs-Data-Structures" class="headerlink" title="Objects vs Data Structures"></a>Objects vs Data Structures</h3><p>Before analyzing the memory cost any further, a distinction should be made between two kinds of objects:</p>
<ul>
<li>OOP Objects</li>
<li>Data Objects (aka Data Structures)</li>
</ul>
<blockquote>
<p>Objects expose behavior and hide data.</p>
<p>Data Structures expose data and have no significant behavior.</p>
<p>— <a href="https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882" target="_blank" rel="noopener">Robert Martin “Clean Code”</a></p>
</blockquote>
<p>I’ll take a look again at the <code>TodoModel</code> example and explain these two kinds of objects.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function TodoModel()&#123;</span><br><span class="line">    var todos = [];</span><br><span class="line">           </span><br><span class="line">    function add() &#123; &#125;</span><br><span class="line">    function reload()&#123; &#125;</span><br><span class="line">       </span><br><span class="line">    return Object.freeze(&#123;</span><br><span class="line">        add,</span><br><span class="line">        reload</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>TodoModel</code> is responsible for storing and managing the list of <code>todos</code>. <code>TodoModel</code> is the OOP Object, the one exposing behavior and hiding data. There will be only one instance of it in the application, so there’s no extra memory cost when using the factory function.</li>
<li>The <code>todos</code> objects represent the Data Structures. There may be a lot of these objects, but they are just plain JavaScript objects. We are not interested in keeping their methods private — rather we actually want to expose all their data and methods. So all these objects will be built over the prototype system, and they will benefit from the memory conservation. They can be built using a simple object literal or <code>Object.create()</code> .</li>
</ul>
<h4 id="UI-Components"><a href="#UI-Components" class="headerlink" title="UI Components"></a>UI Components</h4><p>In the application, there may be hundreds or thousands of instances of a UI component. This is a situation where we need to make a trade-off between encapsulation and memory conservation.</p>
<p>Components will be built according to the component framework practice. For example, object literals will be used for Vue, or classes for React. Each component’s members will be public, but they will benefit from the memory conservation of the prototype system.</p>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>The strong points of class are its familiarity for people coming from a class-based background and its nicer syntax over the prototype system. However, its security problems and the usage of <code>this</code>, a continuous source of losing context bugs, makes it a second option. As an exception, classes will be used if required by the component’s framework, as in the case of React.</p>
<p>Factory function is not only the better option for creating secured, encapsulated, and flexible OOP Objects but also opens the door for a new, unique to JavaScript, programming paradigm.</p>
<blockquote>
<p>I think Class Free Object Oriented Programming is JavaScript’s gift to humanity.                                          </p>
<p>— <a href="https://www.youtube.com/watch?v=DxnYQRuLX7Q&amp;feature=youtu.be&amp;t=45m41s" target="_blank" rel="noopener">Douglas Crockford “The Better Parts”</a></p>
</blockquote>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/JavaScript/" <i="" class="fa fa-tag"> JavaScript</a>
          
            <a href="/tags/转载/" <i="" class="fa fa-tag"> 转载</a>
          
            <a href="/tags/ES6/" <i="" class="fa fa-tag"> ES6</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/09/04/2018-09-04-VK-mistake-4/" rel="next" title="VK的秋招前端奇遇记(四)">
                <i class="fa fa-chevron-left"></i> VK的秋招前端奇遇记(四)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/09/10/2018-09-10-Teachers-day/" rel="prev" title="学生时代的最后一个教师节">
                学生时代的最后一个教师节 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/taka.png" alt="Vincent Ko">
            
              <p class="site-author-name" itemprop="name">Vincent Ko</p>
              <p class="site-description motion-element" itemprop="description">忧绪相伴，在浪漫的气息中回忆过去，敲着代码</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">21</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">30</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/forrany" title="GitHub &rarr; https://github.com/forrany" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:im.vincentko@gmail.com" title="E-Mail &rarr; mailto:im.vincentko@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://weibo.com/Vincent_Kooo" title="Weibo &rarr; https://weibo.com/Vincent_Kooo" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://twitter.com/vincent_kooo" title="Twitter &rarr; https://twitter.com/vincent_kooo" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                推荐阅读
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://wangyaxing.cn/" title="https://wangyaxing.cn/" rel="noopener" target="_blank">王亚星博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://reuixiy.github.io/" title="https://reuixiy.github.io/" rel="noopener" target="_blank">reuixiy</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://shenzekun.cn/" title="http://shenzekun.cn/" rel="noopener" target="_blank">moorez</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://richardcao.me/" title="https://richardcao.me/" rel="noopener" target="_blank">lifecycle</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Encapsulation"><span class="nav-number">1.</span> <span class="nav-text">Encapsulation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#this"><span class="nav-number">2.</span> <span class="nav-text">this</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#this-and-arrow-function"><span class="nav-number">2.1.</span> <span class="nav-text">this and arrow function</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Immutable-API"><span class="nav-number">3.</span> <span class="nav-text">Immutable API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#new"><span class="nav-number">4.</span> <span class="nav-text">new</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Composition-over-inheritance"><span class="nav-number">5.</span> <span class="nav-text">Composition over inheritance</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory"><span class="nav-number">6.</span> <span class="nav-text">Memory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Objects-vs-Data-Structures"><span class="nav-number">7.</span> <span class="nav-text">Objects vs Data Structures</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#UI-Components"><span class="nav-number">7.1.</span> <span class="nav-text">UI Components</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Conclusion"><span class="nav-number">8.</span> <span class="nav-text">Conclusion</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Vincent Ko</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">120k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点阅读时长">3:38</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v6.6.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
      
  
  <script color="135,127,127" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>



  
  











  
  
    <script src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/three/three.min.js"></script>
  

  
  
    <script src="/lib/three/three-waves.min.js"></script>
  


  


  <script src="/js/src/utils.js?v=6.6.0"></script>

  <script src="/js/src/motion.js?v=6.6.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.6.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.6.0"></script>



  
  <script src="/js/src/scrollspy.js?v=6.6.0"></script>
<script src="/js/src/post-details.js?v=6.6.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>

  <script>
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: true,
        appId: '9z5cWwHgCpPYDuHc0wDVBrUM-gzGzoHsz',
        appKey: 'rvAwm3XwE2eqCqQPRoVJcA12',
        placeholder: 'Just go go',
        avatar:'mm',
        meta:guest,
        pageSize:'10' || 10,
        visitor: false
    });
  </script>




  

  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  
  

  

  

  

  

  

  

</body>
</html>
